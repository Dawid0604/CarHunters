name: "Dashboards"

services:
  user-service-pgadmin:
    build: resources/pgadmin
    container_name: user-service-pgadmin
    environment:
      PGADMIN_DEFAULT_EMAIL: ${USER_MICROSERVICE_PGADMIN_EMAIL}
      PGADMIN_DEFAULT_PASSWORD: ${USER_MICROSERVICE_PGADMIN_PASSWORD}
      SERVER_NAME: user-service-db-server
      DATABASE_HOST: user-service-postgres-db
      DATABASE_PORT: ${USER_MICROSERVICE_POSTGRES_PORT}
      DATABASE_NAME: ${USER_MICROSERVICE_POSTGRES_DB}
      DATABASE_USER: ${USER_MICROSERVICE_POSTGRES_USER}
      DATABASE_PASSWORD: ${USER_MICROSERVICE_POSTGRES_PASSWORD}

    ports:
      - "${USER_SERVICE_PGADMIN_PORT}:80"

    depends_on:
      user-service-postgres-db:
        condition: service_healthy

    networks:
      - carhunters_network

  notification-service-mongo-db-express:
    image: mongo-express:1.0.2-20-alpine3.19
    container_name: notification-db-express
    restart: unless-stopped
    environment:
      ME_CONFIG_MONGODB_URL: mongodb://${NOTIFICATION_MICROSERVICE_MONGO_DB_USER}:${NOTIFICATION_MICROSERVICE_MONGO_DB_PASSWORD}@notification-mongo-db:${NOTIFICATION_MICROSERVICE_MONGO_DB_PORT}/${NOTIFICATION_MICROSERVICE_MONGO_DB_AUTHENTICATION_DATABASE}?authSource=admin
      ME_CONFIG_BASICAUTH_USERNAME: ${NOTIFICATION_MICROSERVICE_MONGO_EXPRESS_USER}
      ME_CONFIG_BASICAUTH_PASSWORD: ${NOTIFICATION_MICROSERVICE_MONGO_EXPRESS_PASSWORD}

    ports:
      - "${NOTIFICATION_SERVICE_MONGO_DB_EXPRESS_PORT}:8081"

    depends_on:
      notification-mongo-db:
        condition: service_healthy

    deploy:
      resources:
        limits:
          memory: 700M
        reservations:
          memory: 256M

    networks:
      - carhunters_network

  kafka-ui:
    image: provectuslabs/kafka-ui:v0.7.2
    container_name: kafka-ui
    environment:
      KAFKA_CLUSTERS_0_NAME: local
      KAFKA_CLUSTERS_0_BOOTSTRAPSERVERS: kafka:29092
      KAFKA_CLUSTERS_0_ZOOKEEPER: zookeeper:2181

    ports:
      - "${KAFKA_UI_PORT}:8080"

    depends_on:
      zookeeper:
        condition: service_healthy

      kafka:
        condition: service_healthy

    deploy:
      resources:
        limits:
          memory: 700M
        reservations:
          memory: 256M

    networks:
      - carhunters_network

  favorite-service-pgadmin:
    build: resources/pgadmin
    container_name: favorite-service-pgadmin
    environment:
      PGADMIN_DEFAULT_EMAIL: ${FAVORITE_MICROSERVICE_PGADMIN_EMAIL}
      PGADMIN_DEFAULT_PASSWORD: ${FAVORITE_MICROSERVICE_PGADMIN_PASSWORD}
      SERVER_NAME: favorite-service-db-server
      DATABASE_HOST: favorite-service-postgres-db
      DATABASE_PORT: ${FAVORITE_MICROSERVICE_POSTGRES_PORT}
      DATABASE_NAME: ${FAVORITE_MICROSERVICE_POSTGRES_DB}
      DATABASE_USER: ${FAVORITE_MICROSERVICE_POSTGRES_USER}
      DATABASE_PASSWORD: ${FAVORITE_MICROSERVICE_POSTGRES_PASSWORD}

    ports:
      - "${FAVORITE_SERVICE_PGADMIN_PORT}:80"

    depends_on:
      favorite-service-postgres-db:
        condition: service_healthy

    networks:
      - carhunters_network

  car-service-pgadmin:
    build: resources/pgadmin
    container_name: car-service-pgadmin
    environment:
      PGADMIN_DEFAULT_EMAIL: ${CAR_MICROSERVICE_PGADMIN_EMAIL}
      PGADMIN_DEFAULT_PASSWORD: ${CAR_MICROSERVICE_PGADMIN_PASSWORD}
      SERVER_NAME: car-service-db-server
      DATABASE_HOST: car-service-postgres-db
      DATABASE_PORT: ${CAR_MICROSERVICE_POSTGRES_PORT}
      DATABASE_NAME: ${CAR_MICROSERVICE_POSTGRES_DB}
      DATABASE_USER: ${CAR_MICROSERVICE_POSTGRES_USER}
      DATABASE_PASSWORD: ${CAR_MICROSERVICE_POSTGRES_PASSWORD}

    ports:
      - "${CAR_SERVICE_SERVICE_PGADMIN_PORT}:80"

    depends_on:
      car-service-postgres-db:
        condition: service_healthy

    networks:
      - carhunters_network

  car-history-service-mongo-db-express:
    image: mongo-express:1.0.2-20-alpine3.19
    container_name: car-history-db-express
    restart: unless-stopped
    environment:
      ME_CONFIG_MONGODB_URL: mongodb://${CAR_HISTORY_MICROSERVICE_MONGO_DB_USER}:${CAR_HISTORY_MICROSERVICE_MONGO_DB_PASSWORD}@car-history-mongo-db:${CAR_HISTORY_MICROSERVICE_MONGO_DB_PORT}/${CAR_HISTORY_MICROSERVICE_MONGO_DB_AUTHENTICATION_DATABASE}?authSource=admin
      ME_CONFIG_BASICAUTH_USERNAME: ${CAR_HISTORY_MICROSERVICE_MONGO_EXPRESS_USER}
      ME_CONFIG_BASICAUTH_PASSWORD: ${CAR_HISTORY_MICROSERVICE_MONGO_EXPRESS_PASSWORD}

    ports:
      - "${CAR_HISTORY_SERVICE_MONGO_DB_EXPRESS_PORT}:8081"

    depends_on:
      car-history-mongo-db:
        condition: service_healthy

    deploy:
      resources:
        limits:
          memory: 700M
        reservations:
          memory: 256M

    networks:
      - carhunters_network

networks:
  carhunters_network:
    driver: bridge
    name: carhunters_network